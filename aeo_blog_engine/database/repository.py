from .models import Blog


def create_blog_entry(session, *, topic, company_url, email_id=None, brand_name=None, blog=None, status="PENDING"):
    entry = Blog(
        topic=topic,
        company_url=company_url,
        email_id=email_id,
        brand_name=brand_name,
        blog=blog or "",
        status=status,
    )
    session.add(entry)
    session.flush()  # populate autogenerated fields
    return entry


def get_blog_by_id(session, blog_id):
    return session.query(Blog).filter(Blog.id == blog_id).one_or_none()


def update_blog_status(session, blog_id, *, status, blog_content=None):
    blog = get_blog_by_id(session, blog_id)
    if not blog:
        raise ValueError(f"Blog with id {blog_id} not found")

    blog.status = status
    if blog_content is not None:
        blog.blog = blog_content

    session.add(blog)
    return blog


def save_social_post(session, blog_id, platform, content):
    blog = get_blog_by_id(session, blog_id)
    if not blog:
        raise ValueError(f"Blog with id {blog_id} not found")

    if platform.lower() == "twitter":
        blog.twitter_post = content
    elif platform.lower() == "linkedin":
        blog.linkedin_post = content
    elif platform.lower() == "reddit":
        blog.reddit_post = content
    else:
        raise ValueError(f"Unsupported platform for saving: {platform}")

    session.add(blog)
    return blog
